<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Text → Speech</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:2rem;max-width:800px}
    textarea{width:100%;height:180px}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
    button,select{padding:.6rem 1rem}
    audio{width:100%;margin-top:14px}
  </style>
</head>
<body>
  <h1>Text → Speech</h1>
  <textarea id="text" placeholder="Type or paste your text here..."></textarea>
  <div class="row">
    <select id="voice">
      <option value="alloy">alloy</option>
      <option value="verse">verse</option>
      <option value="bright">bright</option>
    </select>
    <select id="format">
      <option value="mp3">mp3</option>
      <option value="wav">wav</option>
    </select>
    <button id="go">Generate</button>
  </div>
  <div id="status"></div>
  <audio id="player" controls></audio>

  <script>
    // Render API endpoint
    const API_URL = "https://website-dcgu.onrender.com/tts"; // <- your Render URL

    // ⚠️ For public use, DON'T hardcode secrets in the browser.
    // If your API requires X-APP-KEY, use a proxy (we can add later).
    const USE_KEY = false; // set true only for private testing
    const APP_KEY = "my-super-token-123";

    const el = (id) => document.getElementById(id);
    el("go").onclick = async () => {
      const text = el("text").value.trim();
      if (!text) { alert("Enter some text"); return; }

      const voice = el("voice").value;
      const format = el("format").value;

      el("status").textContent = "Generating (first call may take ~30–50s on free Render)…";
      const headers = { "Content-Type": "application/json" };
      if (USE_KEY) headers["X-APP-KEY"] = APP_KEY;

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers,
          body: JSON.stringify({ text, voice, format })
        });

        if (!res.ok) {
          const msg = await res.text();
          throw new Error(`API error ${res.status}: ${msg}`);
        }

        const blob = await res.blob();
        const url = URL.createObjectURL(blob);
        el("player").src = url;
        el("player").play();
        el("status").textContent = "Ready ✔";
      } catch (e) {
        console.error(e);
        el("status").textContent = e.message;
        alert(e.message);
      }
    };
  </script>
</body>
</html>
